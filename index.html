<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestão de Estoque - COENG | DETEC</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Configurações Tailwind -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "sans-serif"] },
            colors: {
              brand: {
                50: "#eff6ff",
                100: "#dbeafe",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                900: "#1e3a8a",
              },
            },
          },
        },
      };
    </script>

    <style>
      /* CSS Base e Utilitários */
      body {
        font-family: "Inter", sans-serif;
        -webkit-font-smoothing: antialiased;
      }

      /* Animações */
      .animate-fade-in {
        animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      .animate-slide-up {
        animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      .animate-scale-in {
        animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
      .animate-spin-slow {
        animation: spin 2s linear infinite;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* Scrollbar Customizada */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Toast Notifications Container */
      #toast-container {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        pointer-events: none;
      }
      .toast {
        pointer-events: auto;
        box-shadow:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 text-slate-800 h-screen overflow-hidden selection:bg-brand-100 selection:text-brand-900"
  >
    <!-- Container de Notificações (Toasts) -->
    <div id="toast-container"></div>

    <!-- Tela de Carregamento Inicial -->
    <div
      id="loading-screen"
      class="fixed inset-0 bg-white z-[60] flex flex-col items-center justify-center"
    >
      <div class="relative w-16 h-16 mb-4">
        <div
          class="absolute inset-0 rounded-full border-4 border-slate-100"
        ></div>
        <div
          class="absolute inset-0 rounded-full border-4 border-brand-600 border-t-transparent animate-spin"
        ></div>
      </div>
      <h2 class="text-lg font-bold text-slate-900">
        Conectando ao Firebase...
      </h2>
      <p class="text-sm text-slate-500 mt-2" id="loading-text">
        Sincronizando dados em tempo real
      </p>
    </div>

    <!-- ================== TELA DE LOGIN ================== -->
    <div
      id="login-layout"
      class="hidden flex h-full w-full items-center justify-center bg-slate-100 p-4"
    >
      <div
        class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-slide-up border border-slate-200"
      >
        <div class="text-center mb-8">
          <div
            class="bg-brand-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-brand-600/20 transform transition-transform hover:scale-105 duration-300"
          >
            <i data-lucide="package" class="text-white w-8 h-8"></i>
          </div>
          <h1 class="text-2xl font-bold text-slate-900 tracking-tight">
            SEROB Estoque
          </h1>
          <p class="text-slate-500 mt-2 text-sm">
            Faça login para gerenciar o almoxarifado
          </p>
        </div>

        <form id="login-form" class="space-y-5">
          <div>
            <label
              class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5"
              >Usuário</label
            >
            <div class="relative group">
              <i
                data-lucide="user"
                class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-brand-500 transition-colors"
              ></i>
              <input
                type="text"
                id="login-username"
                placeholder="Digite seu usuário"
                class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all bg-slate-50 focus:bg-white"
                required
              />
            </div>
          </div>

          <div>
            <label
              class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5"
              >Senha</label
            >
            <div class="relative group">
              <i
                data-lucide="lock"
                class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 group-focus-within:text-brand-500 transition-colors"
              ></i>
              <input
                type="password"
                id="login-password"
                placeholder="••••••••"
                class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all bg-slate-50 focus:bg-white"
                required
              />
            </div>
          </div>

          <div
            id="login-error"
            class="hidden p-3 bg-red-50 border border-red-100 text-red-600 text-sm rounded-lg flex items-center gap-2 animate-pulse"
          >
            <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0"></i>
            <span>Usuário ou senha incorretos.</span>
          </div>

          <button
            type="submit"
            class="w-full bg-brand-600 text-white font-semibold py-3.5 rounded-xl hover:bg-brand-700 active:bg-brand-800 transition-all shadow-lg shadow-brand-600/20 flex items-center justify-center gap-2 group"
          >
            <span>Entrar no Sistema</span>
            <i
              data-lucide="arrow-right"
              class="w-5 h-5 group-hover:translate-x-1 transition-transform"
            ></i>
          </button>
        </form>

        <p class="text-center text-xs text-slate-400 mt-8 font-medium">
          Versão 4.1.1 Real-Time (Firebase)
        </p>
      </div>
    </div>

    <!-- ================== LAYOUT DA APLICAÇÃO ================== -->
    <div id="app-layout" class="hidden h-full flex overflow-hidden">
      <!-- Mobile Overlay -->
      <div
        id="mobile-overlay"
        class="fixed inset-0 bg-slate-900/50 z-20 hidden lg:hidden backdrop-blur-sm transition-opacity"
        onclick="App.toggleSidebar()"
      ></div>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="fixed lg:static inset-y-0 left-0 z-30 w-72 bg-white border-r border-slate-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col shadow-2xl lg:shadow-none"
      >
        <div
          class="p-6 border-b border-slate-100 flex items-center gap-3 bg-slate-50/50"
        >
          <div class="bg-brand-600 p-2.5 rounded-xl shadow-sm">
            <i data-lucide="package" class="text-white w-6 h-6"></i>
          </div>
          <div>
            <h1 class="font-bold text-lg text-slate-900 leading-tight">
              SEROB
            </h1>
            <p class="text-xs font-medium text-slate-500">
              Gestão de Estoque - COENG | DETEC
            </p>
          </div>
        </div>

        <nav class="p-4 space-y-1.5 flex-1 overflow-y-auto custom-scrollbar">
          <button
            onclick="App.navigate('dashboard')"
            id="nav-dashboard"
            class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200"
          >
            <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
          </button>
          <button
            onclick="App.navigate('movements')"
            id="nav-movements"
            class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200"
          >
            <i data-lucide="arrow-right-left" class="w-5 h-5"></i> Movimentações
          </button>
        </nav>

        <div class="p-4 border-t border-slate-100 space-y-4 bg-slate-50/30">
          <!-- User Profile -->
          <div
            class="flex items-center gap-3 px-2 py-2 rounded-lg border border-transparent hover:border-slate-200 hover:bg-white transition-all cursor-default"
          >
            <div
              class="w-10 h-10 rounded-full bg-slate-200 flex-shrink-0 flex items-center justify-center text-slate-600 font-bold overflow-hidden shadow-inner ring-2 ring-white"
              id="user-avatar"
            >
              <!-- Icon injected by JS -->
            </div>
            <div class="flex-1 overflow-hidden">
              <p
                class="text-sm font-bold text-slate-900 whitespace-nowrap"
                id="user-name"
              >
                Usuário
              </p>
              <p class="text-xs text-slate-500 truncate" id="user-role">
                Função
              </p>
            </div>
          </div>

          <!-- Admin Tools -->
          <div
            id="admin-tools"
            class="hidden bg-white rounded-xl border border-slate-200 p-4 shadow-sm"
          >
            <p
              class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2"
            >
              Administração
            </p>
            <label
              class="relative flex flex-col items-center justify-center w-full py-3 border-2 border-slate-200 border-dashed rounded-xl cursor-pointer bg-slate-50/50 hover:bg-white hover:border-brand-400 hover:shadow-md hover:shadow-brand-100/50 transition-all duration-300 group mb-3"
            >
              <div
                class="flex items-center justify-center gap-3 transition-transform group-hover:-translate-y-0.5 duration-300"
              >
                <div
                  class="p-1.5 bg-white rounded-lg border border-slate-200 shadow-sm group-hover:border-brand-200 text-slate-400 group-hover:text-brand-600 transition-colors"
                >
                  <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                </div>
                <div class="flex flex-col text-left">
                  <span
                    class="text-[10px] font-semibold text-slate-600 group-hover:text-brand-700 transition-colors"
                    >Importar CSV</span
                  >
                  <span
                    class="text-[8px] text-slate-400 group-hover:text-brand-500 transition-colors"
                    >Clique para enviar</span
                  >
                </div>
              </div>
              <input
                type="file"
                accept=".csv"
                class="hidden"
                onchange="App.handleFileUpload(event)"
              />
            </label>
            <div
              class="flex items-center justify-center gap-1 text-[9px] text-green-600 mt-2 font-medium"
            >
              <div
                class="w-2 h-2 rounded-full bg-green-500 animate-pulse"
              ></div>
              Online - Firebase (Real-time)
            </div>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button
              onclick="App.openPasswordModal()"
              class="flex items-center justify-center gap-2 px-3 py-2.5 text-xs font-semibold text-slate-600 bg-white border border-slate-200 hover:bg-slate-50 hover:border-slate-300 rounded-lg transition-all shadow-sm"
              title="Alterar Senha"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="w-4 h-4"
              >
                <rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Senha
            </button>
            <button
              onclick="App.logout()"
              class="flex items-center justify-center gap-2 px-3 py-2.5 text-xs font-semibold text-red-600 bg-red-50 border border-red-100 hover:bg-red-100 rounded-lg transition-all shadow-sm"
              title="Sair do Sistema"
            >
              <i data-lucide="log-out" class="w-4 h-4"></i> Sair
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main
        class="flex-1 flex flex-col min-w-0 overflow-hidden bg-slate-50/50 relative"
      >
        <header
          class="bg-white border-b border-slate-200 p-4 flex items-center justify-between lg:hidden flex-shrink-0 z-10 shadow-sm"
        >
          <div class="flex items-center gap-3">
            <button
              onclick="App.toggleSidebar()"
              class="p-2 -ml-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors"
            >
              <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <span class="font-bold text-slate-900"
              >Gestão de Estoque - COENG | DETEC</span
            >
          </div>
          <div
            class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden border border-slate-300"
            id="mobile-user-avatar"
          >
            <!-- Icon -->
          </div>
        </header>

        <!-- Dynamic Content -->
        <div
          id="content-area"
          class="flex-1 overflow-y-auto p-4 lg:p-8 custom-scrollbar scroll-smooth"
        >
          <!-- Conteúdo injetado via JS -->
        </div>
      </main>
    </div>

    <!-- ================== MODALS ================== -->

    <!-- Modal Movimentação -->
    <div
      id="modal-movement"
      class="fixed inset-0 bg-slate-900/60 z-50 hidden items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0 pointer-events-none"
      aria-hidden="true"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform scale-95 transition-all duration-300"
        id="modal-movement-content"
      >
        <div class="flex justify-between items-start mb-6">
          <div>
            <h3
              id="modal-mov-title"
              class="text-xl font-bold text-slate-900 tracking-tight"
            >
              Registrar Entrada
            </h3>
            <p
              id="modal-mov-item"
              class="text-sm font-medium text-slate-500 mt-1"
            >
              Nome do Item
            </p>
          </div>
          <button
            onclick="ModalManager.close('modal-movement')"
            class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-colors"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>

        <div
          class="bg-slate-50 p-5 rounded-xl mb-6 border border-slate-100 flex justify-between items-center shadow-inner"
        >
          <div>
            <p
              class="text-[10px] font-bold text-slate-400 uppercase tracking-wider"
            >
              Estoque Atual
            </p>
            <p
              id="modal-mov-current"
              class="text-2xl font-mono text-slate-700 font-semibold"
            >
              0
            </p>
          </div>
          <div class="h-8 w-px bg-slate-200"></div>
          <div class="text-right">
            <p
              class="text-[10px] font-bold text-slate-400 uppercase tracking-wider"
            >
              Novo Saldo
            </p>
            <p
              id="modal-mov-new"
              class="text-2xl font-mono font-bold text-slate-900"
            >
              0
            </p>
          </div>
        </div>

        <div class="mb-8">
          <label class="block text-sm font-semibold text-slate-700 mb-2"
            >Quantidade</label
          >
          <div class="relative">
            <input
              type="number"
              id="modal-mov-qty"
              min="1"
              value="1"
              oninput="InventoryController.calculateNewStock()"
              class="w-full px-4 py-3 text-lg font-medium border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-500 focus:border-transparent outline-none transition-shadow"
              placeholder="0"
            />
            <div
              class="absolute right-3 top-1/2 -translate-y-1/2 flex flex-col"
            >
              <button
                onclick="InventoryController.adjustQty(1)"
                class="text-slate-400 hover:text-brand-600"
              >
                <i data-lucide="chevron-up" class="w-4 h-4"></i>
              </button>
              <button
                onclick="InventoryController.adjustQty(-1)"
                class="text-slate-400 hover:text-brand-600"
              >
                <i data-lucide="chevron-down" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="flex gap-3">
          <button
            onclick="ModalManager.close('modal-movement')"
            class="flex-1 px-4 py-3 rounded-xl font-semibold bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 hover:border-slate-300 transition-all"
          >
            Cancelar
          </button>
          <button
            id="modal-mov-confirm"
            onclick="InventoryController.confirmMovement()"
            class="flex-1 px-4 py-3 rounded-xl font-bold text-white shadow-lg transition-all transform active:scale-95"
          >
            Confirmar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Senha -->
    <div
      id="modal-password"
      class="fixed inset-0 bg-slate-900/60 z-50 hidden items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0 pointer-events-none"
      aria-hidden="true"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform scale-95 transition-all duration-300"
        id="modal-password-content"
      >
        <div class="flex justify-between items-start mb-6">
          <div>
            <h3 class="text-xl font-bold text-slate-900 tracking-tight">
              Alterar Senha
            </h3>
            <p class="text-sm text-slate-500 mt-1">
              Atualize suas credenciais de segurança
            </p>
          </div>
          <button
            onclick="ModalManager.close('modal-password')"
            class="text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-full transition-colors"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>

        <form onsubmit="AuthController.changePassword(event)" class="space-y-4">
          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase mb-1.5"
              >Senha Atual</label
            >
            <input
              type="password"
              id="pwd-current"
              class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"
              required
            />
          </div>
          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase mb-1.5"
              >Nova Senha</label
            >
            <input
              type="password"
              id="pwd-new"
              class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"
              required
            />
          </div>
          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase mb-1.5"
              >Confirmar Nova Senha</label
            >
            <input
              type="password"
              id="pwd-confirm"
              class="w-full px-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition-all"
              required
            />
          </div>
          <div class="flex gap-3 pt-4">
            <button
              type="button"
              onclick="ModalManager.close('modal-password')"
              class="flex-1 px-4 py-2.5 rounded-xl font-semibold bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 transition-all"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="flex-1 px-4 py-2.5 rounded-xl font-bold bg-brand-600 text-white hover:bg-brand-700 shadow-md transition-all"
            >
              Salvar Alterações
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ================== JAVASCRIPT ENGINE (MODULE) ================== -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        setDoc,
        doc,
        updateDoc,
        writeBatch,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
      import {
        getAuth,
        signInAnonymously,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

      // Configuração fornecida pelo usuário
      const firebaseConfig = {
        apiKey: "AIzaSyDCu2wlBkSbD7wLvTmoZdz1ICjg5rpCzsM",
        authDomain: "gestao-de-estoque-20615.firebaseapp.com",
        projectId: "gestao-de-estoque-20615",
        storageBucket: "gestao-de-estoque-20615.firebasestorage.app",
        messagingSenderId: "925516712156",
        appId: "1:925516712156:web:4c8fa2f49982c03fca8c19",
      };

      // Inicialização Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // --- Dados Semente (Fallback e Migração) ---
      const DEFAULT_PASSWORD_HASH =
        "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3";
      const SEED_USERS = [
        {
          name: "Jefferson de Araújo Silva",
          username: "jefferson",
          role: "admin",
          label: "Administrador",
          passwordHash: DEFAULT_PASSWORD_HASH,
        },
        {
          name: "Antônio Pinto Melo Sousa Júnior",
          username: "antonio",
          role: "user",
          label: "Usuário",
          passwordHash: DEFAULT_PASSWORD_HASH,
        },
        {
          name: "Jessé Souza dos Anjos",
          username: "jesse",
          role: "user",
          label: "Usuário",
          passwordHash: DEFAULT_PASSWORD_HASH,
        },
      ];

      const SEED_ITEMS = [
        // DEPÓSITO C4 - GÁS
        {
          id: 1,
          codigo: "B.16.04.007",
          codigoInterno: "39201",
          descricao: "GÁS 13 KG",
          categoria: "DEPÓSITO C4 - GÁS",
          unidade: "Unidade",
          estoque: 22,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 2,
          codigo: "B.16.04.006",
          codigoInterno: "39633",
          descricao: "BOTIJÃO DE GÁS P-13 (VASILHAME)",
          categoria: "DEPÓSITO C4 - GÁS",
          unidade: "Unidade",
          estoque: 30,
          estoqueMinimo: 10,
          qtdRessuprimento: 15,
        },
        {
          id: 3,
          codigo: "****",
          codigoInterno: "****",
          descricao: "GÁS EM USO",
          categoria: "DEPÓSITO C4 - GÁS",
          unidade: "Unidade",
          estoque: 4,
          estoqueMinimo: 1,
          qtdRessuprimento: 2,
        },
        {
          id: 4,
          codigo: "****",
          codigoInterno: "****",
          descricao: "BOTIJÃO VAZIO",
          categoria: "DEPÓSITO C4 - GÁS",
          unidade: "Unidade",
          estoque: 4,
          estoqueMinimo: 1,
          qtdRessuprimento: 2,
        },
        // DEPÓSITO 01 - IMPERMEABILIZAÇÃO
        {
          id: 5,
          codigo: "B.02.05.009",
          codigoInterno: "39630",
          descricao: "BOCAL PARA ARREMATES EM RALOS, D=100MM",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Peça",
          estoque: 28,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 6,
          codigo: "B.02.05.010",
          codigoInterno: "39631",
          descricao: "BOCAL PARA ARREMATES EM RALOS, D=150MM",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Peça",
          estoque: 10,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 7,
          codigo: "B.02.05.008",
          codigoInterno: "39632",
          descricao: "BOCAL PARA ARREMATES EM RALOS, D=75MM",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Peça",
          estoque: 25,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 8,
          codigo: "B.02.04.002",
          codigoInterno: "39787",
          descricao: "EMULSÃO ASFÁLTICA PARA IMPRIMAÇÃO (BASE ÁGUA)",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Balde",
          estoque: 4,
          estoqueMinimo: 2,
          qtdRessuprimento: 5,
        },
        {
          id: 9,
          codigo: "B.02.03.001",
          codigoInterno: "20827",
          descricao: "IMPERMEABILIZANTE FLEXÍVEL BASE RESINA (5.000)",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Caixa",
          estoque: 95,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 10,
          codigo: "B.02.03.002",
          codigoInterno: "19437",
          descricao: "IMPERMEABILIZANTE SEMIFLEXÍVEL (1.000)",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Caixa",
          estoque: 93,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 11,
          codigo: "B.02.01.002",
          codigoInterno: "18389",
          descricao: "MANTA ANTIRAIZ",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "m²",
          estoque: 110,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 12,
          codigo: "B.02.05.003",
          codigoInterno: "39789",
          descricao: "PAPEL KRAFT PARA IMPERMEABILIZAÇÃO",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Unidade",
          estoque: 300,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 13,
          codigo: "B.02.04.003",
          codigoInterno: "16493",
          descricao: "PRIMER ASFÁLTICO",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Galão",
          estoque: 10,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 14,
          codigo: "B.02.02.003",
          codigoInterno: "27574",
          descricao: "SELANTE BRANCO",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Tubo",
          estoque: 336,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 15,
          codigo: "B.02.02.001",
          codigoInterno: "30314",
          descricao: "SELANTE CINZA",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Tubo",
          estoque: 444,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 16,
          codigo: "B.02.02.002",
          codigoInterno: "27575",
          descricao: "SELANTE PRETO",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Tubo",
          estoque: 144,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 17,
          codigo: "B.02.04.006",
          codigoInterno: "39685",
          descricao: "TINTA ASFÁLTICA ANTIRRAIZ",
          categoria: "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
          unidade: "Galão",
          estoque: 0,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        // DEPÓSITO 02 - TINTA ESMALTE
        {
          id: 18,
          codigo: "B.10.03.003",
          codigoInterno: "25068",
          descricao: "FUNDO PARA AÇO GALVANIZADO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 11,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 19,
          codigo: "B.10.02.012",
          codigoInterno: "4121",
          descricao: "TINTA ESMALTE SINTÉTICO ACETINADO BRANCO GELO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 31,
          estoqueMinimo: 10,
          qtdRessuprimento: 15,
        },
        {
          id: 20,
          codigo: "B.10.02.011",
          codigoInterno: "4132",
          descricao: "TINTA ESMALTE SINTÉTICO ACETINADO BRANCO NEVE",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 11,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 21,
          codigo: "B.10.02.006",
          codigoInterno: "4143",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO ALUMÍNIO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 6,
          estoqueMinimo: 2,
          qtdRessuprimento: 5,
        },
        {
          id: 22,
          codigo: "B.10.02.007",
          codigoInterno: "29091",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO AMARELO TRATOR",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 17,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 23,
          codigo: "B.10.02.008",
          codigoInterno: "29094",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO AZUL MAR",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 9,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 24,
          codigo: "B.10.02.002",
          codigoInterno: "4092",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO BRANCO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 16,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 25,
          codigo: "B.10.02.003",
          codigoInterno: "29090",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO BRANCO GELO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 38,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 26,
          codigo: "B.10.02.005",
          codigoInterno: "37914",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO CINZA MÉDIO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 9,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 27,
          codigo: "B.10.02.009",
          codigoInterno: "4128",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO PRETO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 18,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 28,
          codigo: "B.10.02.001",
          codigoInterno: "27439",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO VERDE COLONIAL",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 385,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 29,
          codigo: "B.10.02.010",
          codigoInterno: "4071",
          descricao: "TINTA ESMALTE SINTÉTICO ALTO BRILHO VERMELHO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 19,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 30,
          codigo: "B.10.02.022",
          codigoInterno: "14790",
          descricao: "TINTA ESMALTE SINTÉTICO FOSCO PRETO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 16,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 31,
          codigo: "B.10.03.001",
          codigoInterno: "35974",
          descricao: "TINTA ESMALTE SINTÉTICO GRAFITE ESCURO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 385,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 32,
          codigo: "B.10.02.023",
          codigoInterno: "29096",
          descricao: "TINTA ESMALTE SINTÉTICO MARTELADO CINZA CLARO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Galão",
          estoque: 5,
          estoqueMinimo: 2,
          qtdRessuprimento: 5,
        },
        {
          id: 33,
          codigo: "B.10.03.006",
          codigoInterno: "20914",
          descricao: "TINTA SPRAY BRANCO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Unidade",
          estoque: 420,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 34,
          codigo: "B.10.03.004",
          codigoInterno: "4159",
          descricao: "TINTA SPRAY PRETO FOSCO",
          categoria: "DEPÓSITO 02 - TINTA ESMALTE",
          unidade: "Unidade",
          estoque: 408,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        // DEPÓSITO 03 - COLA FÓRMICA
        {
          id: 35,
          codigo: "B.05.06.001",
          codigoInterno: "4617",
          descricao: "ADESIVO DE CONTATO - COLA FÓRMICA",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Galão",
          estoque: 956,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 36,
          codigo: "B.16.04.008",
          codigoInterno: "27039",
          descricao: "GASOLINA COMUM",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Litro",
          estoque: 0,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 37,
          codigo: "B.16.04.010",
          codigoInterno: "27040",
          descricao: "ÓLEO DIESEL",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Litro",
          estoque: 5,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 38,
          codigo: "B.16.04.005",
          codigoInterno: "1544",
          descricao: "QUEROSENE 900 ML",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Lata",
          estoque: 83,
          estoqueMinimo: 20,
          qtdRessuprimento: 40,
        },
        {
          id: 39,
          codigo: "B.05.06.002",
          codigoInterno: "1536",
          descricao: "SOLVENTE PARA ADESIVO DE CONTATO (REDUCOLA)",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Lata",
          estoque: 658,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 40,
          codigo: "B.16.04.003",
          codigoInterno: "1538",
          descricao: "SOLVENTE THINNER",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Lata",
          estoque: 660,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 41,
          codigo: "B.07.01.004",
          codigoInterno: "29098",
          descricao: "TINTA TRÁFEGO AMARELA",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Galão",
          estoque: 11,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 42,
          codigo: "B.07.01.005",
          codigoInterno: "29097",
          descricao: "TINTA TRÁFEGO BRANCA",
          categoria: "DEPÓSITO 03 - COLA FÓRMICA",
          unidade: "Galão",
          estoque: 12,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        // DEPÓSITO 04 - ÁLCOOL
        {
          id: 45,
          codigo: "B.16.04.001",
          codigoInterno: "5819",
          descricao: "ÁLCOOL",
          categoria: "DEPÓSITO 04 - ÁLCOOL",
          unidade: "Litro",
          estoque: 368,
          estoqueMinimo: 100,
          qtdRessuprimento: 100,
        },
        {
          id: 46,
          codigo: "B.16.04.002",
          codigoInterno: "37697",
          descricao: "ÁLCOOL EM GEL 2L",
          categoria: "DEPÓSITO 04 - ÁLCOOL",
          unidade: "Unidade",
          estoque: 102,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        // DEPÓSITO 12 - PISO VINÍLICO
        {
          id: 47,
          codigo: "B.18.01.001",
          codigoInterno: "39957",
          descricao: "PERFIL PARA ARREMATE DE CARPETE",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "Metro",
          estoque: 111.0,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 48,
          codigo: "B.08.01.010",
          codigoInterno: "13722",
          descricao: "PISO AZUL",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "Caixa",
          estoque: 29.0,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 49,
          codigo: "B.08.01.007",
          codigoInterno: "3046",
          descricao: "PISO CINZA",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "Caixa",
          estoque: 192.0,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 50,
          codigo: "B.08.01.009",
          codigoInterno: "3047",
          descricao: "PISO PRETO",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "Caixa",
          estoque: 128.0,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 51,
          codigo: "B.08.01.003",
          codigoInterno: "35235",
          descricao: "PISO SEMIFLEXÍVEL MADEIRA",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "m²",
          estoque: 393.8,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 52,
          codigo: "B.08.01.006",
          codigoInterno: "29864",
          descricao: "PISO VERDE-ITAMARATY",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "m²",
          estoque: 672.0,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 53,
          codigo: "B.08.01.001",
          codigoInterno: "37736",
          descricao:
            "PISO VINÍLICO AUTOPORTANTE COR CINZA ESCURO 50 CM X 50 CM",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "m²",
          estoque: 200.0,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 54,
          codigo: "B.08.01.004",
          codigoInterno: "35969",
          descricao: "RODAPÉ SEMIFLEXÍVEL",
          categoria: "DEPÓSITO 12 - PISO VINÍLICO",
          unidade: "Metro",
          estoque: 1094.4,
          estoqueMinimo: 200,
          qtdRessuprimento: 500,
        },
        // DEPÓSITO 25 - TINTA ACRÍLICA
        {
          id: 55,
          codigo: "B.16.10.001",
          codigoInterno: "25742",
          descricao: "FITA CREPE 25 MM X 50 M",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Rolo",
          estoque: 1104,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 56,
          codigo: "B.16.10.002",
          codigoInterno: "39894",
          descricao: "FITA CREPE 45 X 50M",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 912,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 57,
          codigo: "B.10.06.001",
          codigoInterno: "35740",
          descricao: "GARFO PARA ROLO 23CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 216,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 58,
          codigo: "B.16.09.001",
          codigoInterno: "4636",
          descricao: "LIXA PARA MADEIRA Nº 60",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 1050,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 59,
          codigo: "B.16.09.002",
          codigoInterno: "4637",
          descricao: "LIXA PARA MADEIRA Nº 80",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 950,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 60,
          codigo: "B.16.09.003",
          codigoInterno: "4622",
          descricao: "LIXA PARA MADEIRA Nº 100",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 1400,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 61,
          codigo: "B.16.09.004",
          codigoInterno: "4623",
          descricao: "LIXA PARA MADEIRA Nº 120",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 4950,
          estoqueMinimo: 100,
          qtdRessuprimento: 500,
        },
        {
          id: 62,
          codigo: "B.16.09.005",
          codigoInterno: "4638",
          descricao: "LIXA PARA MADEIRA Nº 150",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 750,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 63,
          codigo: "B.16.09.006",
          codigoInterno: "4624",
          descricao: "LIXA PARA MADEIRA Nº 180",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 950,
          estoqueMinimo: 100,
          qtdRessuprimento: 200,
        },
        {
          id: 64,
          codigo: "B.16.09.007",
          codigoInterno: "35693",
          descricao: "LIXA PARA MADEIRA Nº 220",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 200,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 65,
          codigo: "B.10.04.002",
          codigoInterno: "27573",
          descricao: "MASSA ACRÍLICA",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 6,
          estoqueMinimo: 5,
          qtdRessuprimento: 10,
        },
        {
          id: 66,
          codigo: "B.10.04.001",
          codigoInterno: "19335",
          descricao: "MASSA CORRIDA",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 82,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 67,
          codigo: "B.10.05.005",
          codigoInterno: "20664",
          descricao: "ROLO DE ESPUMA 15 CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 120,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 68,
          codigo: "B.10.05.007",
          codigoInterno: "20662",
          descricao: "ROLO DE ESPUMA 5 CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 288,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 69,
          codigo: "B.10.05.006",
          codigoInterno: "20663",
          descricao: "ROLO DE ESPUMA 9 CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 276,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 70,
          codigo: "B.10.05.003",
          codigoInterno: "35976",
          descricao: "ROLO DE LÃ 15 CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 192,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 71,
          codigo: "B.10.05.001",
          codigoInterno: "20665",
          descricao: "ROLO DE LÃ 23 CM PARA TETO (ANTI-GOTAS)",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 360,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 72,
          codigo: "B.10.05.004",
          codigoInterno: "26670",
          descricao: "ROLO DE LÃ 9 CM",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 540,
          estoqueMinimo: 20,
          qtdRessuprimento: 100,
        },
        {
          id: 73,
          codigo: "-",
          codigoInterno: "-",
          descricao:
            "ROLO DE LÃ EXTRA - PELE NOBRE DE CARNEIRO - 23 CM DE LARGURA E 25 MM DE ALTURA",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 6,
          estoqueMinimo: 2,
          qtdRessuprimento: 10,
        },
        {
          id: 74,
          codigo: "B.10.05.002",
          codigoInterno: "29101",
          descricao: "ROLO PARA PINTURA EPÓXI",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Peça",
          estoque: 60,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 75,
          codigo: "-",
          codigoInterno: "-",
          descricao: "SELADOR ACRILÍCO",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 3,
          estoqueMinimo: 1,
          qtdRessuprimento: 5,
        },
        {
          id: 76,
          codigo: "B.10.01.001",
          codigoInterno: "27650",
          descricao: "TINTA ACRÍLICA FOSCA BRANCO NEVE",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 180,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
        {
          id: 77,
          codigo: "B.10.01.004",
          codigoInterno: "27651",
          descricao: "TINTA ACRÍLICA FOSCA CONCRETO",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 6,
          estoqueMinimo: 2,
          qtdRessuprimento: 5,
        },
        {
          id: 78,
          codigo: "B.10.01.002",
          codigoInterno: "23150",
          descricao: "TINTA ACRÍLICA SEMIBRILHO BRANCO GELO 18 L",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 59,
          estoqueMinimo: 10,
          qtdRessuprimento: 20,
        },
        {
          id: 79,
          codigo: "B.10.01.003",
          codigoInterno: "22924",
          descricao: "TINTA ACRÍLICA SEMIBRILHO BRANCO NEVE 18 L",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 39,
          estoqueMinimo: 10,
          qtdRessuprimento: 10,
        },
        {
          id: 80,
          codigo: "B.10.01.005",
          codigoInterno: "19342",
          descricao: "TINTA LÁTEX ACRÍLICA PISO CINZA",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 11,
          estoqueMinimo: 5,
          qtdRessuprimento: 5,
        },
        {
          id: 81,
          codigo: "B.10.01.006",
          codigoInterno: "19341",
          descricao: "TINTA LÁTEX ACRÍLICA PISO PRETO",
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Lata",
          estoque: 4,
          estoqueMinimo: 1,
          qtdRessuprimento: 5,
        },
        {
          id: 82,
          codigo: "B.10.05.009",
          codigoInterno: "4136",
          descricao: 'TRINCHA MACIA 1"',
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 300,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 83,
          codigo: "B.10.05.010",
          codigoInterno: "4134",
          descricao: 'TRINCHA MACIA 1.1/2"',
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 492,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 84,
          codigo: "B.10.05.011",
          codigoInterno: "4137",
          descricao: 'TRINCHA MACIA 2"',
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 492,
          estoqueMinimo: 50,
          qtdRessuprimento: 100,
        },
        {
          id: 85,
          codigo: "B.10.05.013",
          codigoInterno: "29102",
          descricao: 'TRINCHA PARA TINTA EPÓXI 3"',
          categoria: "DEPÓSITO 25 - TINTA ACRÍLICA",
          unidade: "Unidade",
          estoque: 252,
          estoqueMinimo: 20,
          qtdRessuprimento: 50,
        },
      ];

      // --- Serviços (Firestore) ---

      const FirestoreService = {
        users: [],
        items: [],

        async init() {
          try {
            // Autenticação Anônima para acessar o Firestore
            await signInAnonymously(auth);
            console.log("Conectado ao Firebase.");

            // Carrega usuários (uma vez é suficiente para auth)
            await this.syncUsers();

            // Inicia Listener em Tempo Real para Itens
            // Retorna uma promessa que resolve apenas quando os primeiros dados chegarem
            await new Promise((resolve) => {
              this.setupRealtimeListener(resolve);
            });
          } catch (e) {
            console.error("Erro ao conectar Firebase:", e);
            alert("Erro ao conectar ao banco de dados. Verifique sua conexão.");
          }
        },

        async syncUsers() {
          const usersRef = collection(db, "users");
          const usersSnap = await getDocs(usersRef);

          if (usersSnap.empty) {
            const localUsers = JSON.parse(
              localStorage.getItem("serob_db_users"),
            );
            const usersToUpload = localUsers || SEED_USERS;
            const batch = writeBatch(db);
            for (const user of usersToUpload) {
              if (user.password && !user.passwordHash) {
                user.passwordHash = await SecurityUtils.hash(user.password);
                delete user.password;
              }
              const docRef = doc(db, "users", user.username);
              batch.set(docRef, user);
            }
            await batch.commit();
            this.users = usersToUpload;
          } else {
            this.users = usersSnap.docs.map((d) => d.data());
          }
        },

        setupRealtimeListener(onFirstLoad) {
          const itemsRef = collection(db, "items");

          // onSnapshot escuta mudanças em tempo real
          onSnapshot(itemsRef, async (snapshot) => {
            if (snapshot.empty) {
              // Se vazio, faz o seed inicial
              document.getElementById("loading-text").innerText =
                "Criando banco de dados...";
              const localItems = JSON.parse(
                localStorage.getItem("serob_db_items"),
              );
              const itemsToUpload = localItems || SEED_ITEMS;
              const batch = writeBatch(db);
              itemsToUpload.forEach((item) => {
                const docRef = doc(db, "items", String(item.id));
                batch.set(docRef, item);
              });
              await batch.commit();
              // O snapshot vai disparar novamente com os dados inseridos
            } else {
              // Atualiza a lista local com os dados novos do Firebase
              this.items = snapshot.docs.map((d) => d.data());

              // Verifica migração de campos novos (Ressuprimento/Mínimo)
              this.checkAndMigrateItems();

              // Atualiza a interface do usuário imediatamente
              if (window.App && typeof window.App.refreshUI === "function") {
                window.App.refreshUI();
              }

              // Se for a primeira carga, resolve a promessa do init
              if (onFirstLoad) {
                onFirstLoad();
                onFirstLoad = null; // Garante que só chama uma vez
              }
            }
          });
        },

        checkAndMigrateItems() {
          const batch = writeBatch(db);
          let hasUpdates = false;

          this.items.forEach((item) => {
            const seed = SEED_ITEMS.find((s) => s.id === item.id);
            if (seed) {
              let updated = false;
              if (item.qtdRessuprimento === undefined) {
                item.qtdRessuprimento = seed.qtdRessuprimento;
                updated = true;
              }
              if (item.estoqueMinimo === undefined) {
                item.estoqueMinimo = seed.estoqueMinimo;
                updated = true;
              }

              if (updated) {
                const docRef = doc(db, "items", String(item.id));
                batch.update(docRef, {
                  qtdRessuprimento: item.qtdRessuprimento,
                  estoqueMinimo: item.estoqueMinimo,
                });
                hasUpdates = true;
              }
            }
          });

          if (hasUpdates) {
            console.log("Sincronizando novos campos...");
            batch.commit();
          }
        },

        async updateStock(id, qty, type) {
          const itemIndex = this.items.findIndex((i) => i.id === id);
          if (itemIndex === -1) return false;

          const item = this.items[itemIndex];
          let newStock = item.estoque;
          if (type === "entrada") newStock += qty;
          else newStock = Math.max(0, newStock - qty);

          // NÃO atualizamos this.items manualmente aqui.
          // Esperamos o Firebase confirmar e mandar o onSnapshot atualizar a tela.
          // Isso garante que o dado na tela é REAL.

          try {
            const itemRef = doc(db, "items", String(id));
            await updateDoc(itemRef, { estoque: newStock });
            return true;
          } catch (e) {
            console.error("Erro ao salvar no Firebase:", e);
            return false;
          }
        },

        async updateUserPassword(username, newHash) {
          try {
            const userRef = doc(db, "users", username);
            await updateDoc(userRef, { passwordHash: newHash });

            // Atualiza local
            const userIndex = this.users.findIndex(
              (u) => u.username === username,
            );
            if (userIndex > -1) this.users[userIndex].passwordHash = newHash;

            return true;
          } catch (e) {
            console.error(e);
            return false;
          }
        },

        async importItems(newItems) {
          const batch = writeBatch(db);
          newItems.forEach((item) => {
            const docRef = doc(db, "items", String(item.id));
            batch.set(docRef, item);
          });
          await batch.commit();

          // Recarrega memória
          this.items = [...this.items, ...newItems];
          return true;
        },
      };

      const SecurityUtils = {
        async hash(string) {
          const utf8 = new TextEncoder().encode(string);
          const hashBuffer = await crypto.subtle.digest("SHA-256", utf8);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
        },
      };

      const AuthService = {
        state: { currentUser: null },

        async login(username, password) {
          // Busca dos usuários carregados na memória pelo FirestoreService
          const users = FirestoreService.users;
          const targetUser = users.find(
            (u) => u.username === username.toLowerCase().trim(),
          );

          if (!targetUser) return false;

          const inputHash = await SecurityUtils.hash(password);

          if (targetUser.passwordHash === inputHash) {
            this.state.currentUser = targetUser;
            // Salva sessão no LocalStorage apenas para persistir o login ao recarregar
            // Mas os dados vêm do Firebase
            localStorage.setItem("serob_session", JSON.stringify(targetUser));
            return true;
          }
          return false;
        },

        logout() {
          this.state.currentUser = null;
          localStorage.removeItem("serob_session");
        },

        async changePassword(newPassword) {
          if (!this.state.currentUser) return false;
          const newHash = await SecurityUtils.hash(newPassword);

          if (
            await FirestoreService.updateUserPassword(
              this.state.currentUser.username,
              newHash,
            )
          ) {
            this.state.currentUser.passwordHash = newHash;
            localStorage.setItem(
              "serob_session",
              JSON.stringify(this.state.currentUser),
            );
            return true;
          }
          return false;
        },

        getCurrentUser() {
          return this.state.currentUser;
        },

        restoreSession() {
          const user = JSON.parse(localStorage.getItem("serob_session"));
          if (user) this.state.currentUser = user;
        },

        isAdmin() {
          return (
            this.state.currentUser && this.state.currentUser.role === "admin"
          );
        },
      };

      // --- UI Managers ---
      const ToastManager = {
        container: document.getElementById("toast-container"),
        show(message, type = "success") {
          const toast = document.createElement("div");
          const colors = type === "success" ? "bg-green-500" : "bg-red-500";
          const icon = type === "success" ? "check-circle" : "alert-circle";
          toast.className = `toast flex items-center gap-3 px-4 py-3 rounded-xl text-white ${colors} animate-scale-in`;
          toast.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i><span class="font-medium text-sm">${message}</span>`;
          this.container.appendChild(toast);
          lucide.createIcons();
          setTimeout(() => {
            toast.style.opacity = "0";
            toast.style.transform = "translateY(-10px)";
            setTimeout(() => toast.remove(), 300);
          }, 3000);
        },
      };

      const ModalManager = {
        open(id) {
          const modal = document.getElementById(id);
          if (!modal) return;
          modal.classList.remove("hidden");
          modal.classList.add("flex");
          requestAnimationFrame(() => {
            modal.classList.remove("opacity-0", "pointer-events-none");
            modal
              .querySelector('div[id$="-content"]')
              ?.classList.remove("scale-95");
            modal
              .querySelector('div[id$="-content"]')
              ?.classList.add("scale-100");
          });
        },
        close(id) {
          const modal = document.getElementById(id);
          if (!modal) return;
          modal.classList.add("opacity-0", "pointer-events-none");
          modal
            .querySelector('div[id$="-content"]')
            ?.classList.remove("scale-100");
          modal.querySelector('div[id$="-content"]')?.classList.add("scale-95");
          setTimeout(() => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
          }, 300);
        },
      };

      // --- Controllers ---
      const AuthController = {
        async handleLogin(e) {
          e.preventDefault();
          const user = document.getElementById("login-username").value;
          const pass = document.getElementById("login-password").value;
          const btn = e.target.querySelector("button");
          const originalText = btn.innerHTML;

          btn.innerHTML = `<i data-lucide="loader" class="w-5 h-5 animate-spin"></i>`;
          lucide.createIcons();
          btn.disabled = true;

          try {
            if (await AuthService.login(user, pass)) {
              App.initLayout();
            } else {
              const err = document.getElementById("login-error");
              err.classList.remove("hidden");
              setTimeout(() => err.classList.add("hidden"), 3000);
            }
          } catch (err) {
            console.error(err);
            alert("Erro ao fazer login. Verifique o console.");
          } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
            lucide.createIcons();
          }
        },

        async changePassword(e) {
          e.preventDefault();
          const current = document.getElementById("pwd-current").value;
          const newPwd = document.getElementById("pwd-new").value;
          const confirm = document.getElementById("pwd-confirm").value;
          const currentUser = AuthService.getCurrentUser();

          const currentHash = await SecurityUtils.hash(current);
          if (currentHash !== currentUser.passwordHash) {
            ToastManager.show("Senha atual incorreta.", "error");
            return;
          }
          if (newPwd.length < 3) {
            ToastManager.show("Nova senha muito curta.", "error");
            return;
          }
          if (newPwd !== confirm) {
            ToastManager.show("Confirmação não coincide.", "error");
            return;
          }

          const btn = e.target.querySelector('button[type="submit"]');
          const originalText = btn.innerHTML;
          btn.innerHTML = "Salvando...";
          btn.disabled = true;

          if (await AuthService.changePassword(newPwd)) {
            ToastManager.show("Senha alterada com sucesso!");
            ModalManager.close("modal-password");
            e.target.reset();
          } else {
            ToastManager.show("Erro ao salvar senha.", "error");
          }

          btn.innerHTML = originalText;
          btn.disabled = false;
        },
      };

      const InventoryController = {
        state: {
          activeModalItem: null,
          activeModalType: "entrada",
          searchTerm: "",
          categoryFilter: "Todas",
        },

        openMovementModal(itemId, type) {
          const item = FirestoreService.items.find((i) => i.id === itemId);
          if (!item) return;
          this.state.activeModalItem = item;
          this.state.activeModalType = type;
          document.getElementById("modal-mov-title").innerText =
            type === "entrada" ? "Registrar Entrada" : "Registrar Saída";
          document.getElementById("modal-mov-item").innerText = item.descricao;
          document.getElementById("modal-mov-current").innerText = item.estoque;
          document.getElementById("modal-mov-qty").value = 1;
          const btn = document.getElementById("modal-mov-confirm");
          btn.className = `flex-1 px-4 py-3 rounded-xl font-bold text-white shadow-lg transition-all transform active:scale-95 ${type === "entrada" ? "bg-green-600 hover:bg-green-700 shadow-green-600/20" : "bg-red-600 hover:bg-red-700 shadow-red-600/20"}`;
          this.calculateNewStock();
          ModalManager.open("modal-movement");
        },

        calculateNewStock() {
          const qty =
            parseInt(document.getElementById("modal-mov-qty").value) || 0;
          const current = this.state.activeModalItem.estoque;
          let newVal = 0;
          const el = document.getElementById("modal-mov-new");
          if (this.state.activeModalType === "entrada") {
            newVal = current + qty;
            el.className = "text-2xl font-mono font-bold text-green-600";
          } else {
            newVal = Math.max(0, current - qty);
            el.className = "text-2xl font-mono font-bold text-red-600";
          }
          el.innerText = newVal;
        },

        adjustQty(delta) {
          const input = document.getElementById("modal-mov-qty");
          let val = parseInt(input.value) || 0;
          val = Math.max(1, val + delta);
          input.value = val;
          this.calculateNewStock();
        },

        async confirmMovement() {
          const qty =
            parseInt(document.getElementById("modal-mov-qty").value) || 0;
          if (qty <= 0) return;

          const btn = document.getElementById("modal-mov-confirm");
          const originalText = btn.innerText;
          btn.innerText = "Salvando...";
          btn.disabled = true;

          if (
            await FirestoreService.updateStock(
              this.state.activeModalItem.id,
              qty,
              this.state.activeModalType,
            )
          ) {
            ToastManager.show(`Movimentação salva no Firebase!`);
            ModalManager.close("modal-movement");
            if (App.currentTab === "dashboard") App.renderDashboard();
            else App.renderTableRows();
          } else {
            ToastManager.show("Erro ao salvar.", "error");
          }

          btn.innerText = originalText;
          btn.disabled = false;
        },

        handleSearch(val) {
          this.state.searchTerm = val;
          App.renderTableRows();
        },

        handleCategory(val) {
          this.state.categoryFilter = val;
          App.renderTableRows();
        },
      };

      // --- Aplicação Principal ---
      const App = {
        currentTab: "dashboard",

        async init() {
          // Restore session FIRST so currentUser is available if logged in
          AuthService.restoreSession();

          // Inicializa Firebase
          await FirestoreService.init();

          // Remove tela de loading
          document.getElementById("loading-screen").classList.add("hidden");

          const loginForm = document.getElementById("login-form");
          if (loginForm)
            loginForm.addEventListener("submit", AuthController.handleLogin);

          if (AuthService.getCurrentUser()) {
            this.initLayout();
          } else {
            document.getElementById("login-layout").classList.remove("hidden");
          }
          lucide.createIcons();
        },

        refreshUI() {
          // Only refresh if user is logged in, otherwise UI is Login Screen
          if (!AuthService.getCurrentUser()) return;

          // Re-renderiza a tela atual com os dados novos
          if (this.currentTab === "dashboard") {
            this.renderDashboard();
          } else {
            // Se estiver em movimentações, atualiza a tabela preservando filtros
            this.renderTableRows();
          }
        },

        resetData() {
          if (
            confirm(
              "ATENÇÃO: Isso irá apagar todos os dados no Firebase e restaurar os itens originais. Deseja continuar?",
            )
          ) {
            FirestoreService.resetData();
          }
        },

        initLayout() {
          document.getElementById("login-layout").classList.add("hidden");
          const appLayout = document.getElementById("app-layout");
          appLayout.classList.remove("hidden");
          appLayout.classList.add("animate-fade-in");
          this.updateUserProfile();
          this.navigate(this.currentTab);
        },

        updateUserProfile() {
          const user = AuthService.getCurrentUser();
          if (!user) return;
          document.getElementById("user-name").innerText =
            user.name.split(" ")[0];
          document.getElementById("user-role").innerText = user.label;
          const iconHtml = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-full h-full p-1 fill-slate-600"><path d="M15.71,12.71a6,6,0,1,0-7.42,0,10,10,0,0,0-6.22,8.18,1,1,0,0,0,2,.22,8,8,0,0,1,15.9,0,1,1,0,0,0,1,.89h.11a1,1,0,0,0,.88-1.1A10,10,0,0,0,15.71,12.71ZM12,12a4,4,0,1,1,4-4A4,4,0,0,1,12,12Z"/></svg>`;
          document.getElementById("user-avatar").innerHTML = iconHtml;
          document.getElementById("mobile-user-avatar").innerHTML = iconHtml;

          const adminTools = document.getElementById("admin-tools");
          if (AuthService.isAdmin()) adminTools.classList.remove("hidden");
          else adminTools.classList.add("hidden");
        },

        navigate(tab) {
          this.currentTab = tab;
          const btnDash = document.getElementById("nav-dashboard");
          const btnMov = document.getElementById("nav-movements");
          const activeClass =
            "bg-brand-50 text-brand-700 shadow-sm ring-1 ring-brand-200";
          const inactiveClass = "text-slate-600 hover:bg-slate-50";

          if (tab === "dashboard") {
            btnDash.className = `w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${activeClass}`;
            btnMov.className = `w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${inactiveClass}`;
            this.renderDashboard();
          } else {
            btnDash.className = `w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${inactiveClass}`;
            btnMov.className = `w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${activeClass}`;
            this.renderMovementsLayout();
          }

          const sidebar = document.getElementById("sidebar");
          if (!sidebar.classList.contains("-translate-x-full"))
            this.toggleSidebar();
        },

        toggleSidebar() {
          const sidebar = document.getElementById("sidebar");
          const overlay = document.getElementById("mobile-overlay");
          sidebar.classList.toggle("-translate-x-full");
          overlay.classList.toggle("hidden");
          overlay.classList.toggle("opacity-0");
        },

        logout() {
          AuthService.logout();
          location.reload();
        },

        openPasswordModal() {
          document.getElementById("pwd-current").value = "";
          document.getElementById("pwd-new").value = "";
          document.getElementById("pwd-confirm").value = "";
          ModalManager.open("modal-password");
        },

        // --- Renderers ---
        renderDashboard() {
          const container = document.getElementById("content-area");
          // Guard clause: if user is not logged in, do not attempt to render
          const user = AuthService.getCurrentUser();
          if (!user) return;

          const stats = {
            totalItems: FirestoreService.items.length,
            lowStock: FirestoreService.items.filter(
              (i) => i.estoque <= i.estoqueMinimo,
            ).length,
            totalStock: FirestoreService.items.reduce(
              (acc, curr) => acc + curr.estoque,
              0,
            ),
            categories: [
              ...new Set(FirestoreService.items.map((i) => i.categoria)),
            ].length,
          };

          const h = new Date().getHours();
          const greeting =
            h < 12 ? "Bom dia" : h < 18 ? "Boa tarde" : "Boa noite";

          // Filtra itens com alerta (40% de margem acima do mínimo) ou críticos
          const alertItems = FirestoreService.items
            .filter((i) => i.estoque <= i.estoqueMinimo * 1.4)
            .sort(
              (a, b) =>
                a.estoque / a.estoqueMinimo - b.estoque / b.estoqueMinimo,
            );

          container.innerHTML = `
                    <div class="space-y-8 animate-fade-in pb-10">
                        <div class="flex justify-between items-end">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-900 tracking-tight">${greeting}, ${user.name.split(" ")[0]}!</h2>
                                <p class="text-slate-500 mt-1">Aqui está o panorama atual do almoxarifado (Online).</p>
                            </div>
                            <div class="hidden md:block text-right">
                                <p class="text-xs font-bold uppercase text-slate-400 tracking-wider">Última atualização</p>
                                <p class="text-sm font-mono text-slate-600">${new Date().toLocaleTimeString()}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
                            ${this._createCard("Total de Itens", stats.totalItems, "package", "blue")}
                            ${this._createCard("Itens Críticos", stats.lowStock, "alert-triangle", "red")}
                            ${this._createCard("Estoque Físico", stats.totalStock, "trending-up", "green")}
                            ${this._createCard("Depósitos Ativos", stats.categories, "layout-dashboard", "purple")}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                                <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0">
                                    <h3 class="font-bold text-slate-900 flex items-center gap-2">
                                        <i data-lucide="bell-ring" class="w-4 h-4 text-brand-500"></i>
                                        Alertas de Reposição
                                    </h3>
                                    <button onclick="App.navigate('movements')" class="text-xs font-semibold text-brand-600 bg-brand-50 px-3 py-1.5 rounded-lg hover:bg-brand-100 transition-colors">Ver Estoque</button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="bg-slate-50 text-slate-500 font-semibold uppercase text-[10px] tracking-wider">
                                            <tr>
                                                <th class="px-6 py-4">Item</th>
                                                <th class="px-6 py-4 text-right">Saldo</th>
                                                <th class="px-6 py-4 text-right">Mínimo</th>
                                                <th class="px-6 py-4 text-center">Ressuprimento</th>
                                                <th class="px-6 py-4 text-center">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-100">
                                            ${
                                              alertItems
                                                .slice(0, 5)
                                                .map((item) => {
                                                  const isCritical =
                                                    item.estoque <=
                                                    item.estoqueMinimo;
                                                  const statusClass = isCritical
                                                    ? "bg-red-100 text-red-800 border-red-200"
                                                    : "bg-yellow-100 text-yellow-800 border-yellow-200";
                                                  const statusText = isCritical
                                                    ? "Crítico"
                                                    : "Alerta";
                                                  const stockClass = isCritical
                                                    ? "text-red-600"
                                                    : "text-yellow-600";

                                                  return `
                                                <tr class="hover:bg-slate-50 transition-colors group">
                                                    <td class="px-6 py-4">
                                                        <div class="font-medium text-slate-900 group-hover:text-brand-600 transition-colors">${item.descricao}</div>
                                                        <div class="text-xs text-slate-400">${item.categoria}</div>
                                                    </td>
                                                    <td class="px-6 py-4 text-right font-mono font-bold ${stockClass}">${item.estoque}</td>
                                                    <td class="px-6 py-4 text-right font-mono text-slate-500">${item.estoqueMinimo}</td>
                                                    <td class="px-6 py-4 text-center font-mono text-slate-500 font-bold">${item.qtdRessuprimento || "-"}</td>
                                                    <td class="px-6 py-4 text-center">
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${statusClass}">${statusText}</span>
                                                    </td>
                                                </tr>`;
                                                })
                                                .join("") ||
                                              `<tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">Tudo em ordem! Nenhum alerta.</td></tr>`
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex flex-col">
                                <h3 class="font-bold text-slate-900 mb-6">Top Depósitos</h3>
                                <div class="space-y-5 overflow-y-auto custom-scrollbar flex-1 pr-2">
                                    ${[
                                      ...new Set(
                                        FirestoreService.items.map(
                                          (i) => i.categoria,
                                        ),
                                      ),
                                    ]
                                      .slice(0, 6)
                                      .map((cat) => {
                                        const count =
                                          FirestoreService.items.filter(
                                            (i) => i.categoria === cat,
                                          ).length;
                                        const percent = Math.min(
                                          100,
                                          (count / stats.totalItems) * 100 * 3,
                                        );
                                        return `
                                            <div>
                                                <div class="flex justify-between text-xs mb-1.5 font-medium">
                                                    <span class="text-slate-700 truncate w-3/4" title="${cat}">${cat.replace(/DEPÓSITO |DEP\. /, "")}</span>
                                                    <span class="text-slate-400">${count}</span>
                                                </div>
                                                <div class="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                                    <div class="bg-brand-500 h-2 rounded-full transition-all duration-1000" style="width: ${percent}%"></div>
                                                </div>
                                            </div>`;
                                      })
                                      .join("")}
                                </div>
                            </div>
                        </div>
                    </div>`;
          lucide.createIcons();
        },

        _createCard(title, value, icon, color) {
          const colorMap = {
            blue: {
              bg: "bg-blue-50",
              text: "text-blue-600",
              border: "border-blue-100",
            },
            red: {
              bg: "bg-red-50",
              text: "text-red-600",
              border: "border-red-100",
            },
            green: {
              bg: "bg-green-50",
              text: "text-green-600",
              border: "border-green-100",
            },
            purple: {
              bg: "bg-purple-50",
              text: "text-purple-600",
              border: "border-purple-100",
            },
          };
          const c = colorMap[color];
          return `
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 flex items-start justify-between hover:shadow-md transition-shadow group">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">${title}</p>
                            <h3 class="text-3xl font-bold text-slate-900 group-hover:scale-105 transition-transform origin-left">${value}</h3>
                        </div>
                        <div class="p-3 rounded-xl ${c.bg} ${c.text} ${c.border} border shadow-inner">
                            <i data-lucide="${icon}" class="w-6 h-6"></i>
                        </div>
                    </div>`;
        },

        renderMovementsLayout() {
          const container = document.getElementById("content-area");
          // Guard clause for safety
          if (!AuthService.getCurrentUser()) return;

          const categories = [
            "Todas",
            "DEPÓSITO C4 - GÁS",
            "DEPÓSITO 01 - IMPERMEABILIZAÇÃO",
            "DEPÓSITO 02 - TINTA ESMALTE",
            "DEPÓSITO 03 - COLA FÓRMICA",
            "DEPÓSITO 04 - ÁLCOOL",
            "DEPÓSITO 12 - PISO VINÍLICO",
            "DEPÓSITO 25 - TINTA ACRÍLICA",
            "DEMAP - 01 ao 11",
          ];

          container.innerHTML = `
                    <div class="space-y-6 h-full flex flex-col animate-fade-in">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white p-4 rounded-2xl border border-slate-200 shadow-sm sticky top-0 z-10">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-900">Movimentações</h2>
                                <p class="text-sm text-slate-500">Gerenciar entradas e saídas do estoque</p>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-3">
                                <div class="relative group">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-brand-500 transition-colors"></i>
                                    <input type="text" placeholder="Buscar código, nome..." value="${InventoryController.state.searchTerm}" oninput="InventoryController.handleSearch(this.value)" class="w-full sm:w-64 pl-10 pr-4 py-2.5 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent text-sm bg-slate-50 focus:bg-white transition-all">
                                </div>
                                <div class="relative">
                                    <select onchange="InventoryController.handleCategory(this.value)" class="appearance-none w-full sm:w-64 bg-white border border-slate-300 text-slate-700 py-2.5 pl-4 pr-10 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent text-sm cursor-pointer shadow-sm hover:border-brand-400 transition-colors">
                                        ${categories.map((cat) => `<option value="${cat}" ${InventoryController.state.categoryFilter === cat ? "selected" : ""}>${cat}</option>`).join("")}
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-500">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex-1 flex flex-col">
                            <div class="overflow-auto flex-1 custom-scrollbar">
                                <table class="w-full text-sm text-left relative">
                                    <thead class="bg-slate-50/90 text-slate-500 font-semibold uppercase text-[10px] tracking-wider sticky top-0 z-10 backdrop-blur-sm border-b border-slate-200">
                                        <tr>
                                            <th class="px-6 py-4 w-32">Contrato</th>
                                            <th class="px-6 py-4">Descrição</th>
                                            <th class="px-6 py-4 text-center">Saldo</th>
                                            <th class="px-6 py-4 text-center">Níveis (Mín / Ressup.)</th>
                                            <th class="px-6 py-4 text-center">Status</th>
                                            <th class="px-6 py-4 text-right">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventory-body" class="divide-y divide-slate-100"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>`;
          this.renderTableRows();
        },

        renderTableRows() {
          const tbody = document.getElementById("inventory-body");
          if (!tbody) return;

          const { searchTerm, categoryFilter } = InventoryController.state;
          const items = FirestoreService.items;

          const filtered = items.filter((item) => {
            const searchLower = searchTerm.toLowerCase();
            const matchesSearch =
              item.descricao.toLowerCase().includes(searchLower) ||
              item.codigo.toLowerCase().includes(searchLower) ||
              (item.codigoInterno && item.codigoInterno.includes(searchLower));
            const matchesCategory =
              categoryFilter === "Todas" || item.categoria === categoryFilter;
            return matchesSearch && matchesCategory;
          });

          if (filtered.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-20 text-center flex flex-col items-center justify-center text-slate-400"><div class="bg-slate-50 p-4 rounded-full mb-3"><i data-lucide="search-x" class="w-8 h-8"></i></div><span class="font-medium">Nenhum item encontrado</span><span class="text-xs mt-1">Tente ajustar os filtros de busca</span></td></tr>`;
          } else {
            tbody.innerHTML = filtered
              .map((item) => {
                const min = item.estoqueMinimo || 0;
                const alertThreshold = min * 1.4; // 40% acima do mínimo
                let statusHtml = "";
                let rowClass =
                  "hover:bg-slate-50 transition-colors group border-l-4 border-transparent";

                if (item.estoque <= min) {
                  statusHtml =
                    '<span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-50 text-red-700 border border-red-100 ring-1 ring-red-500/10">Crítico</span>';
                  rowClass += " hover:border-red-500";
                } else if (item.estoque <= alertThreshold) {
                  statusHtml =
                    '<span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-yellow-50 text-yellow-700 border border-yellow-100 ring-1 ring-yellow-500/10">Alerta</span>';
                  rowClass += " hover:border-yellow-500";
                } else {
                  statusHtml =
                    '<span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-50 text-green-700 border border-green-100 ring-1 ring-green-500/10">Normal</span>';
                  rowClass += " hover:border-brand-500";
                }

                return `
                        <tr class="${rowClass}">
                            <td class="px-6 py-4 font-mono text-xs text-slate-500 bg-slate-50/30 group-hover:bg-transparent transition-colors">${item.codigo}</td>
                            <td class="px-6 py-4">
                                <div class="font-semibold text-slate-800 text-sm mb-0.5">${item.descricao}</div>
                                <div class="text-[10px] text-slate-400 uppercase tracking-wide">${item.categoria.replace(/DEPÓSITO |DEP\. /, "")}</div>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <span class="font-mono text-base font-bold ${item.estoque <= min ? "text-red-600" : item.estoque <= alertThreshold ? "text-yellow-600" : "text-slate-700"}">${item.estoque}</span>
                                <span class="text-[10px] text-slate-400 block uppercase">${item.unidade}</span>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <div class="flex flex-col gap-1 items-center">
                                    <div class="text-xs font-medium text-slate-600 bg-slate-100 px-2 py-0.5 rounded border border-slate-200">Min: ${min}</div>
                                    <div class="text-[10px] text-slate-400">Ressup: <b>${item.qtdRessuprimento || "-"}</b></div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-center">
                                ${statusHtml}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex items-center justify-end gap-2 opacity-80 group-hover:opacity-100 transition-opacity">
                                    <button onclick="InventoryController.openMovementModal(${item.id}, 'entrada')" class="p-2 text-green-600 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-all shadow-sm hover:shadow active:scale-95" title="Entrada"><i data-lucide="plus" class="w-4 h-4"></i></button>
                                    <button onclick="InventoryController.openMovementModal(${item.id}, 'saida')" class="p-2 text-red-600 bg-red-50 hover:bg-red-100 border border-red-200 rounded-lg transition-all shadow-sm hover:shadow active:scale-95" title="Saída"><i data-lucide="minus" class="w-4 h-4"></i></button>
                                </div>
                            </td>
                        </tr>`;
              })
              .join("");
          }
          lucide.createIcons();
        },

        async handleFileUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            const text = e.target.result;
            const lines = text.split("\n");
            const newItems = [];
            let currentCategory = "Importado";

            if (file.name.includes("DEP.")) {
              const parts = file.name.split(".");
              if (parts.length > 1) currentCategory = parts[0] + " " + parts[1];
            }

            lines.forEach((line, index) => {
              if (line.length < 10 || line.includes("CÓDIGO DO CONTRATO"))
                return;
              const cols = line.split(",");
              const codigo = cols.find(
                (c) => c && c.match(/B\.\d{2}\.\d{2}\.\d{3}/),
              );

              if (codigo) {
                const descIndex = cols.findIndex(
                  (c) => c.length > 10 && !c.match(/B\.\d{2}/),
                );
                const descricao =
                  cols[descIndex]?.replace(/"/g, "") || "Item importado";
                const numbers = cols
                  .map((c) => parseFloat(c))
                  .filter((n) => !isNaN(n));
                let codigoInterno = "";
                for (let i = 0; i < cols.length; i++) {
                  const val = cols[i].trim();
                  if (!isNaN(val) && val.length >= 4 && val !== codigo) {
                    codigoInterno = val;
                    break;
                  }
                }
                const estoque =
                  numbers.length > 0 ? numbers[numbers.length - 1] : 0;
                // Valor padrão para novos itens importados
                const estoqueMinimo = 10;

                newItems.push({
                  id: Date.now() + index + Math.random(),
                  codigo: codigo,
                  codigoInterno: codigoInterno,
                  descricao: descricao,
                  categoria: currentCategory,
                  unidade: "UN",
                  estoque: estoque,
                  estoqueMinimo: estoqueMinimo,
                  qtdRessuprimento: estoqueMinimo * 2, // Padrão simples
                });
              }
            });

            if (newItems.length > 0) {
              // Importar para Firestore
              const btn =
                document.querySelector('input[type="file"]').parentElement;
              const originalContent = btn.innerHTML; // Backup content logic isn't strictly needed if we rebuild it below, but keeping flow

              btn.innerHTML = `<div class="flex flex-col items-center justify-center py-1"><i data-lucide="loader" class="w-5 h-5 text-brand-500 animate-spin mb-1"></i><span class="text-[10px] font-medium text-slate-500">Processando...</span></div>`;
              lucide.createIcons();

              FirestoreService.importItems(newItems).then(() => {
                ToastManager.show(
                  `${newItems.length} itens importados para o Firebase!`,
                  "success",
                );
                if (App.currentTab === "dashboard") App.renderDashboard();
                else App.renderMovementsLayout();

                // Reset UI com o novo design avançado
                btn.innerHTML = `
                    <div class="flex items-center justify-center gap-3 transition-transform group-hover:-translate-y-0.5 duration-300">
                      <div class="p-1.5 bg-white rounded-lg border border-slate-200 shadow-sm group-hover:border-brand-200 text-slate-400 group-hover:text-brand-600 transition-colors">
                        <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                      </div>
                      <div class="flex flex-col text-left">
                        <span class="text-[10px] font-semibold text-slate-600 group-hover:text-brand-700 transition-colors">Importar CSV</span>
                        <span class="text-[8px] text-slate-400 group-hover:text-brand-500 transition-colors">Clique para enviar</span>
                      </div>
                    </div>
                    <input type="file" accept=".csv" class="hidden" onchange="App.handleFileUpload(event)" />
                  `;
                lucide.createIcons();
              });
            } else {
              ToastManager.show(
                "Formato de arquivo inválido ou sem dados.",
                "error",
              );
            }
          };
          reader.readAsText(file);
          event.target.value = "";
        },
      };

      // --- Main Exports (Expose to Window) ---
      window.App = App;
      window.AuthController = AuthController;
      window.InventoryController = InventoryController;
      window.ModalManager = ModalManager;
      window.FirestoreService = FirestoreService;

      // --- Bootstrap ---
      document.addEventListener("DOMContentLoaded", () => App.init());
    </script>
  </body>
</html>
